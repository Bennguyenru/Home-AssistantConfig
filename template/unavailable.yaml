- sensor:
  - name: 'Unavailable entities'
    unique_id: 'unavailable_entities'
    state: >-
        {{ states|selectattr('state', 'in', ['unavailable'])
                |rejectattr('attributes.restored','in',[true])
                |rejectattr('entity_id','match','^.*([\._]home|_hws_|_next_alarm|minecraft|accuhome|sensor.tasmota_car_)')
                |rejectattr('attributes.supported_features','in',[152461])
                |rejectattr('entity_id','in',['media_player.samsung_tv'])
                |list|length}}

    unit_of_measurement: 'entities'
    attributes:
      entities: >-
        {{ states|selectattr('state', 'in', ['unavailable'])
                |rejectattr('attributes.restored','in',[true])
                |rejectattr('entity_id','match','^.*([\._]home|_hws_|_next_alarm|minecraft|accuhome|sensor.tasmota_car_)')
                |rejectattr('attributes.supported_features','in',[152461])
                |rejectattr('entity_id','in',['media_player.samsung_tv'])
                |map(attribute='entity_id')|list|join(', ')}}
