- sensor:
  - name: 'Unavailable entities'
    unique_id: 'unavailable_entities'
    state: >-
        {{ states|selectattr('state', 'in', ['unavailable'])
                |rejectattr('entity_id','in',['media_player.living_room_tv'])
                |rejectattr('entity_id','match','^.*_old|^.*([\._]home|[\._]other|_hws_|_next_alarm|minecraft|accuhome|sensor.tasmota_car_|espresense_|plex_|roku_x00200y5s7lx|weather.|.kelsie_|.forked_daapd|_train_|_time_to_home|binary_sensor.trains_.*|binary_sensor.return_train_status)')
                |list|length}}
    unit_of_measurement: 'entities'
    attributes:
      entities: >-
        {{ states|selectattr('state', 'in', ['unavailable'])
                |rejectattr('entity_id','in',['media_player.living_room_tv'])
                |rejectattr('entity_id','match','^.*_old|^.*([\._]home|[\._]other|_hws_|_next_alarm|minecraft|accuhome|sensor.tasmota_car_|espresense_|plex_|roku_x00200y5s7lx|weather.|.kelsie|.forked_daapd|_train_|_time_to_home|binary_sensor.trains_.*|binary_sensor.return_train_status)')
                |map(attribute='entity_id')|list|join(', ')}}
