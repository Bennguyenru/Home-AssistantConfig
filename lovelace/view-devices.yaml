title: Devices
id: devices
path: devices
icon: mdi:engine
visible:
  - user: 2e93f54c62e549c8aeperson2748de6bed9d
cards:
- type: entity
  name: "WAN IP"
  entity: sensor.fritz_box_3490_external_ip

- type: glance
  title: Things
  show_header_toggle: false
  #show_state: false
  columns: 5
  entities:
  - entity: binary_sensor.fritz_box_3490_connection
    name: Internet
    show_last_changed: true
  - entity: binary_sensor.fritz_box_3490_link
    name: link
    show_last_changed: true
  - entity: binary_sensor.remote_ui
    show_last_changed: true
  - entity: binary_sensor.first_floor_front
    name: BT Front
    show_last_changed: true
  - entity: binary_sensor.first_floor_rear
    name: BT Rear
    show_last_changed: true

- type: glance
  title: Devices
  show_header_toggle: false
  columns: 3
  entities:
  - entity: media_player.roku_x00200y5s7lx
    name: Family room
  - entity: media_player.cast_living_room_tv
    name: Living room chromecast
  - entity: media_player.samsung_tv
    name: Living room TV
- type: custom:battery-state-card
  title: Battery devices
  sort_by_level: "asc"
  collapse: 8
  color_gradient:
    - "#ff0000" # red
    - "#ffff00" # yellow
    - "#00ff00" # green
  tap_action:
    action: more-info
  entities:
    - entity: sensor.inspire_hr_battery
      state_map:
        - from: "High"
          to: 100
        - from: "Medium"
          to: 50
        - from: "Low"
          to: 20
    - entity: sensor.pixel_xl_battery_level
      charging_state: 
        entity_id: binary_sensor.pixel_xl_is_charging
        state: 'on'
    - entity: sensor.person1_pixel_3_battery_level
      charging_state: 
        entity_id: binary_sensor.person1_pixel_3_is_charging
        state: 'on'
    - entity: sensor.person3_pixel_3a_battery_level
      charging_state: 
        entity_id: binary_sensor.person3_pixel_3a_is_charging
        state: 'on'
    - entity: sensor.sht_al09_battery_level
      charging_state: 
        entity_id: binary_sensor.sht_al09_is_charging
        state: 'on'
    - entity: sensor.person1_lenovo_tb_j606f_battery_level
      charging_state: 
        entity_id: binary_sensor.person1_lenovo_tb_j606f_is_charging
        state: 'on'
    - entity: sensor.dsb_0230_battery_level
      charging_state: 
        entity_id: binary_sensor.dsb_0230_is_charging
        state: 'on'
  filter:
    include:
      - name: entity_id
        value: "*_battery"
      - name: entity_id
        value: "*_battery_level"
    exclude:
      - name: entity_id
        value: "*mobile*"
      - name: name
        operator: "contains"
        value: "Battery Level"
- type: glance
  title: Printer status
  show_header_toggle: false
  columns: 4
  entities:
  - entity: sensor.printer_toner_remaining
    name: Toner
  - entity: sensor.printer_imaging_unit_remaining
    name: Imaging unit
  - entity: sensor.printer_forward_roller_remaining
    name: Forward
  - entity: sensor.printer_pick_up_roller_remaining
    name: Pick up
  - entity: sensor.printer_retard_roller_remaining
    name: Retard
  - entity: sensor.printer_transfer_roller_remaining
    name: Transfer
  - entity: sensor.printer_fuser_life_remaining
    name: Fuser

- type: custom:auto-entities
  card: 
    type: glance
    title: Unavailable entities
  filter:
    include:
      - state: "unavailable"
    exclude:
      - name: /Plex/
      - entity_id: "sensor.pixel_xl_next_alarm"
      - attributes: 
          - domain: media_player
            restored: true

- type: custom:html-template-card
  title: 'Overdue zigbee link status times'
  ignore_line_breaks: true
  content: |-
    Routers:<BR>
    {% for state in states.sensor if '_linkquality' in state.entity_id and state.attributes.unit_of_measurement == 'lqi' and state.attributes.device.type == 'Router' -%}
      {%- set when =  (now()-state.last_updated).seconds -%}
      {%- if when > (60 * 10) -%}
        {{ relative_time(state.last_updated) }} ago for {{ state.name }}<BR>
      {% endif -%}
    {% endfor %}

    <HR>
    Non-Konke:    
    {% for state in states.sensor if '_linkquality' in state.entity_id and 'leak' not in state.entity_id and state.attributes.device.manufacturerID != 4712 and state.attributes.device.model != 'TS0207' and state.attributes.unit_of_measurement == 'lqi' and state.attributes.device.type == 'EndDevice' -%}
      {%- set when =  (now()-state.last_updated).seconds -%}
      {%- if when > (60 * 60 * 1.5) -%}
        {{ relative_time(state.last_updated) }} ago for {{ state.name }}<BR>
      {% endif -%}
    {% endfor %}
    
    <HR>
    Konke:
    {% for state in states.sensor if '_linkquality' in state.entity_id and 'leak' not in state.entity_id and state.attributes.device.manufacturerID == 4712 and state.attributes.device.model != 'TS0207'  and state.attributes.unit_of_measurement == 'lqi' and state.attributes.device.type == 'EndDevice' -%}
      {%- set when =  (now()-state.last_updated).seconds -%}
      {%- if when > (60 * 60 * 3) -%}
        {{ relative_time(state.last_updated) }} ago for {{ state.name }}<BR>
      {% endif -%}
    {% endfor %}
    
    <HR>
    CR Smart home:   
    {% for state in states.sensor if '_linkquality' in state.entity_id and state.attributes.device.model == 'TS0207' and state.attributes.unit_of_measurement == 'lqi' and state.attributes.device.type == 'EndDevice' -%}
      {%- set when =  (now()-state.last_updated).seconds -%}
      {%- if when > (60 * 60 * 5) -%}
        {{ relative_time(state.last_updated) }} ago for {{ state.name }}<BR>
      {% endif -%}
    {% endfor %}
