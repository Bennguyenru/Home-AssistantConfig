title: Devices
id: devices
path: devices
icon: mdi:engine
visible:
  - user: 2e93f54c62e549c8aeperson2748de6bed9d
cards:
- type: conditional
  conditions:
  - entity: binary_sensor.updater
    state: 'on'
  card:
    type: entities
    entities: 
    - entity: binary_sensor.updater
      state_color: true

- type: entity
  name: "WAN IP"
  entity: sensor.fritz_box_3490_external_ip

- type: glance
  title: Things
  show_header_toggle: false
  #show_state: false
  columns: 4
  entities:
  - entity: binary_sensor.fritz_box_3490_connection
    name: Internet
    show_last_changed: true
  - entity: binary_sensor.remote_ui
    show_last_changed: true
  - entity: binary_sensor.first_floor_front
    name: BT Front
    show_last_changed: true
  - entity: binary_sensor.first_floor_rear
    name: BT Rear
    show_last_changed: true

- type: glance
  title: Devices
  show_header_toggle: false
  entities:
  - entity: device_tracker.samsung_electronics_24_b4_13
    name: Family room
  - entity: device_tracker.living_room_chromecast
    name: Living room chromecast
  - entity: media_player.cast_living_room_tv
    name: Living room chromecast
  - entity: media_player.samsung_tv
    name: Living room TV
- type: custom:battery-state-card
  title: Battery devices
  sort_by_level: "asc"
  collapse: 8
  color_gradient:
    - "#ff0000" # red
    - "#ffff00" # yellow
    - "#00ff00" # green
  entities:
  - sensor.bathroom_door_battery 
  - sensor.bathroom_environment_battery 
  - sensor.bathroom_water_leak_battery
  - sensor.bathroom_window_battery 
  - sensor.downstairs_hall_light_sensor_battery 
  - sensor.downstairs_hall_motion_battery 
  - sensor.family_window_left_battery 
  - sensor.family_window_right_battery 
  - sensor.garage_door_car_battery
  - sensor.garage_door_bike_battery
  - sensor.guest_bedroom_door_battery 
  - sensor.guest_bedroom_window_left_battery 
  - sensor.guest_bedroom_window_right_battery 
  - sensor.hue_dimmer_battery 
  - sensor.kitchen_water_leak_battery
  - sensor.kitchen_window_left_battery
  - sensor.kitchen_window_right_battery
  - sensor.master_bedroom_cube_battery
  - sensor.master_bedroom_door_battery 
  - sensor.master_bedroom_light_sensor_battery 
  - sensor.master_ensuite_door_battery 
  - sensor.master_ensuite_environment_battery 
  - sensor.master_window_ensuite_battery 
  - sensor.master_window_left_battery 
  - sensor.master_window_right_battery 
  - sensor.office_button_battery 
  - sensor.office_climate_battery 
  - sensor.office_cube_battery
  - sensor.office_door_battery 
  - sensor.office_motion_konke_battery 
  - sensor.office_window_battery 
  - sensor.patio_window_left_battery 
  - sensor.patio_window_right_battery 
  - sensor.second_bedroom_door_battery 
  - sensor.second_bedroom_ensuite_battery 
  - sensor.second_bedroom_window_ensuite_battery 
  - sensor.second_bedroom_window_left_battery 
  - sensor.second_bedroom_window_right_battery 
  - sensor.second_ensuite_battery
  - sensor.spare_bedroom_window_left_battery 
  - sensor.spare_bedroom_window_right_battery 
  - sensor.toilet_water_leak_battery
  - sensor.utility_room_water_leak_battery
  - sensor.vestibule_multi_battery 
  - sensor.vestibule_window_front_battery 
  - sensor.vestibule_window_side_battery
  - zwave.pi3_front_door
  - zwave.pi3_patio_door_left
  - zwave.pi3_utility_door_exterior
  - zwave.pi3_living_room_multi
  - zwave.pi3_utility
- type: glance
  title: Printer status
  show_header_toggle: false
  columns: 4
  entities:
  - entity: sensor.printer_toner_remaining
    name: Toner
  - entity: sensor.printer_imaging_unit_remaining
    name: Imaging unit
  - entity: sensor.printer_forward_roller_remaining
    name: Forward
  - entity: sensor.printer_pick_up_roller_remaining
    name: Pick up
  - entity: sensor.printer_retard_roller_remaining
    name: Retard
  - entity: sensor.printer_transfer_roller_remaining
    name: Transfer
  - entity: sensor.printer_fuser_life_remaining
    name: Fuser

- type: custom:auto-entities
  card: 
    type: glance
    title: Unavailable entities
  filter:
    include:
      - state: "unavailable"
    exclude:
      - name: /Plex/
      - entity_id: "sensor.pixel_xl_next_alarm"
      - attributes: 
          - domain: media_player
            restored: true

- type: custom:html-template-card
  title: 'Overdue zigbee link status times'
  ignore_line_breaks: true
  content: |-
    Routers:<BR>
    {% for state in states.sensor if '_linkquality' in state.entity_id and state.attributes.unit_of_measurement == 'lqi' and state.attributes.device.type == 'Router' -%}
      {%- set when =  (now()-state.last_updated).seconds -%}
      {%- if when > (60 * 10) -%}
        {{ relative_time(state.last_updated) }} ago for {{ state.name }}<BR>
      {% endif -%}
    {% endfor %}

    <HR>
    Non-Konke:    
    {% for state in states.sensor if '_linkquality' in state.entity_id and 'leak' not in state.entity_id and state.attributes.device.manufacturerID != 4712 and state.attributes.device.model != 'TS0207' and state.attributes.unit_of_measurement == 'lqi' and state.attributes.device.type == 'EndDevice' -%}
      {%- set when =  (now()-state.last_updated).seconds -%}
      {%- if when > (60 * 60 * 1.5) -%}
        {{ relative_time(state.last_updated) }} ago for {{ state.name }}<BR>
      {% endif -%}
    {% endfor %}
    
    <HR>
    Konke:
    {% for state in states.sensor if '_linkquality' in state.entity_id and 'leak' not in state.entity_id and state.attributes.device.manufacturerID == 4712 and state.attributes.device.model != 'TS0207'  and state.attributes.unit_of_measurement == 'lqi' and state.attributes.device.type == 'EndDevice' -%}
      {%- set when =  (now()-state.last_updated).seconds -%}
      {%- if when > (60 * 60 * 3) -%}
        {{ relative_time(state.last_updated) }} ago for {{ state.name }}<BR>
      {% endif -%}
    {% endfor %}
    
    <HR>
    CR Smart home:   
    {% for state in states.sensor if '_linkquality' in state.entity_id and state.attributes.device.model == 'TS0207' and state.attributes.unit_of_measurement == 'lqi' and state.attributes.device.type == 'EndDevice' -%}
      {%- set when =  (now()-state.last_updated).seconds -%}
      {%- if when > (60 * 60 * 5) -%}
        {{ relative_time(state.last_updated) }} ago for {{ state.name }}<BR>
      {% endif -%}
    {% endfor %}
