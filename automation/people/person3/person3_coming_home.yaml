id: 'person3_coming_home'
alias: 'person3 coming home'
initial_state: 'on'
trigger:
  - platform: numeric_state
    entity_id: proximity.person3_home
    below: 550
  - platform: numeric_state
    entity_id: sensor.person3s_time_to_home_by_foot_duration
    below: 10
condition:
  - condition: state
    entity_id: input_boolean.person3_home
    state: 'off'
    for: '00:02:00'
  - condition: template
    value_template: "{{ is_state_attr('proximity.person3_home','dir_of_travel','towards') }}"
  - condition: state
    entity_id: input_boolean.person2_home
    state: 'on'
    for: '00:05:00'
  - condition: numeric_state
    entity_id: proximity.person3_home
    below: 550
  - condition: numeric_state
    entity_id: sensor.person3s_time_to_home_by_foot_duration
    below: 10
action:
  - service: notify.person2_telegram
    data:
      message: "person3's nearly home, and will be home in {{ states('sensor.person3s_time_to_home_by_foot_duration') }} {{ state_attr('sensor.person3s_time_to_home_by_foot_duration','unit_of_measurement') }}"
  - delay: '00:05:00'
