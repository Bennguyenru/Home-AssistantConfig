id: 'person2_up'
alias: 'person2 up'
initial_state: 'on'
trigger:
  # Wake up
 - platform: state
   entity_id: input_boolean.person2_is_awake
   to: 'on'
condition:
  - condition: state
    entity_id: 
      - input_boolean.person2_home
      - input_boolean.master_bedroom_occupied
    state: 'on'
  - condition: time
    after: '03:00:00'
    before: '21:00:00'
action:
  # Turn on the light
  - service: input_select.select_option
    data:
      entity_id: input_select.master_bedroom
      option: 'Wake'
  - service: switch.turn_off
    entity_id: switch.adaptive_lighting_sleep_mode_master_bedroom
  - condition: state
    entity_id: 
      - input_boolean.notify_train_status_work
      - input_boolean.person2_working_trains
    state: 'on'
  # Update the trains
  - service: script.turn_on
    entity_id: script.train_message
  # Wait a moment
  - delay: '00:00:05'
  # And wait for the radio to be turned off (that is, I'm actually awake)
  - wait_template: "{{ is_state('media_player.person2','off') or is_state('media_player.person2','paused') }}"
    timeout: '00:02:00'
    continue_on_timeout: 'true'
  # Now tell me about it
  - service: media_player.turn_on
    data:
      entity_id: media_player.master_bedroom
  - service: media_player.volume_set
    data:
      volume_level: 0.3
      entity_id: media_player.master_bedroom
  - delay: '00:00:01'
  - service: tts.google_cloud_say
    data:
      entity_id: media_player.master_bedroom
      message: "{{ states('input_text.train_message') }}"
  - wait_template: "{{ is_state('media_player.master_bedroom','playing') }}"
  - wait_template: "{{ is_state('media_player.master_bedroom','idle') }}"
  - service: media_player.turn_off
    data:
      entity_id: media_player.master_bedroom
